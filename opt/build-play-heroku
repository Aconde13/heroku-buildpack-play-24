#!/usr/bin/env bash

# Build Play! framework
/usr/bin/ant -buildfile $PLAY_HOME/framework/build.xml

# Clean old tarball
rm -fr build/play-heroku.tar.gz

# Create tmp space for tar'ing
mkdir -p tmp/.play/framework/src/play

# Add Play! framework
cp -r $PLAY_HOME/framework/dependencies.yml tmp/.play/framework
cp -r $PLAY_HOME/framework/lib/             tmp/.play/framework
cp -r $PLAY_HOME/framework/play*.jar        tmp/.play/framework
cp -r $PLAY_HOME/framework/pym/             tmp/.play/framework
cp -r $PLAY_HOME/framework/src/play/version tmp/.play/framework/src/play
cp -r $PLAY_HOME/framework/templates/       tmp/.play/framework

# Add Play! core modules (minus testrunner)
cp -r $PLAY_HOME/modules            tmp/.play
rm -fr tmp/.play/modules/testrunner

# Add Play! Linux executable
cp -r $PLAY_HOME/play               tmp/.play


# Run tar and remove tmp space
if [ ! -d build ]; then
  mkdir build
fi

tar cvzf build/play-heroku.tar.gz -C tmp/ .play
rm -fr tmp/
